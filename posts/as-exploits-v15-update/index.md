# As-Exploits v1.5更新



<meta name="referrer" content="no-referrer" />



## 更新日志
1. 新增支持jspjs/aspxcsharp类型
2. 除内存马/内存马管理模块以外，均支持Tomcat10
3. 内存马注入模块更新:
   1. Filter类型：新增PystingerFilter，SorFilter
   2. 新增WebSocket类型：CmdWs，CmdBase64Ws，JSPJSWs，JSPJSBase64Ws
   3. 不再支持Servlet内存马
4. 内存马管理模块新增Listener、Tomcat-Value、Timer、Websocket 、Upgrade 、ExecutorShell内存马的查杀检测（thx [https://github.com/ruyueattention/java-memshell-scanner](https://github.com/ruyueattention/java-memshell-scanner)）
5. Jar加载器模块内存加载功能BUG修复
6. ShellCode加载-JNA模块更新，提高兼容性跟稳定性
7. execPayload模块支持新增额外参数
8. 新增Js引擎执行模块，可用Payload见：[https://github.com/yzddmr6/Java-Js-Engine-Payloads](https://github.com/yzddmr6/Java-Js-Engine-Payloads)
9. aspxcsharp类型支持回显自定义分隔符
10. aspxcsharp新增SharpLoader模块，支持内存加载、远程加载Assembly；支持获取已加载过的Assembly，无需重复上传；支持传递命令行参数，自动获取输入输出。
## 兼容Tomcat 10
不用多解释
![image.png](https://cdn.nlark.com/yuque/0/2023/png/1599908/1693467973753-205326c8-e09b-4168-8793-4723b4324478.png#averageHue=%23f4f4f4&clientId=uc343d491-e9f7-4&from=paste&height=630&id=u6e51a451&originHeight=1260&originWidth=1694&originalType=binary&ratio=2&rotation=0&showTitle=false&size=1046946&status=done&style=none&taskId=u701fd34e-19d1-4cc5-8e2f-831cd9fdf3f&title=&width=847)
## 新增WebSocket内存马
新增4中WebSocket类型内存马：CmdWs，CmdBase64Ws，JSPJSWs，JSPJSBase64Ws
注意Websocket的路径不能填/*
![image.png](https://cdn.nlark.com/yuque/0/2023/png/1599908/1693813526283-5717d1f3-061e-4b2c-85db-5717c4ff5063.png#averageHue=%23f4f3f3&clientId=uc343d491-e9f7-4&from=paste&height=435&id=x0uC8&originHeight=870&originWidth=1692&originalType=binary&ratio=2&rotation=0&showTitle=false&size=648287&status=done&style=none&taskId=uc86a9098-5bee-47ee-9671-c18d17eb4a7&title=&width=846)
内存马管理模块中可以看到已经注入成功
![image.png](https://cdn.nlark.com/yuque/0/2023/png/1599908/1693813449903-b0d36dd6-f695-45cb-98c0-92230c1ffb88.png#averageHue=%23f0f0f0&clientId=uc343d491-e9f7-4&from=paste&height=801&id=v6rHN&originHeight=1602&originWidth=3008&originalType=binary&ratio=2&rotation=0&showTitle=false&size=1998911&status=done&style=none&taskId=u0dd19550-e80e-41a2-a213-375bddf3011&title=&width=1504)
通过ws协议直接连接
![image.png](https://cdn.nlark.com/yuque/0/2023/png/1599908/1693813561996-6d4d793a-ca3d-4c2f-99ce-08db0ba032d1.png#averageHue=%23f1f1f1&clientId=uc343d491-e9f7-4&from=paste&height=444&id=Rjkh6&originHeight=888&originWidth=1522&originalType=binary&ratio=2&rotation=0&showTitle=false&size=624699&status=done&style=none&taskId=ua7b433b6-b8af-4238-a8a2-b56bffe9cab&title=&width=761)
卸载内存马
![image.png](https://cdn.nlark.com/yuque/0/2023/png/1599908/1693813471254-ed7e12ad-fb60-49cc-8cae-95f153e4fe04.png#averageHue=%23f6f5f5&clientId=uc343d491-e9f7-4&from=paste&height=468&id=laLUM&originHeight=936&originWidth=2476&originalType=binary&ratio=2&rotation=0&showTitle=false&size=956009&status=done&style=none&taskId=u32943dce-70a9-41a1-b74e-7b2c9abca31&title=&width=1238)
也可以打入cmd类型，通过Chrome插件手动发送命令
![image.png](https://cdn.nlark.com/yuque/0/2023/png/1599908/1693553304286-fa58d4a3-5abe-4788-956e-00f4d7738a9c.png#averageHue=%23fbfbfb&clientId=uc343d491-e9f7-4&from=paste&height=546&id=u8916cf48&originHeight=1092&originWidth=2526&originalType=binary&ratio=2&rotation=0&showTitle=false&size=1002171&status=done&style=none&taskId=u11ccf63f-683e-47c9-a28a-a3c2a964270&title=&width=1263)
## 新增6种内存马检测
增加Listener、Tomcat-Value、Timer、Websocket 、Upgrade 、ExecutorShell内存马的查杀检测
核心代码来自：[https://github.com/ruyueattention/java-memshell-scanner](https://github.com/ruyueattention/java-memshell-scanner)
![image.png](https://cdn.nlark.com/yuque/0/2023/png/1599908/1693560540735-ba99ba73-cb51-4a2d-a994-67caa18587cc.png#averageHue=%23ededed&clientId=uc343d491-e9f7-4&from=paste&height=869&id=u1f0f46cb&originHeight=1738&originWidth=3000&originalType=binary&ratio=2&rotation=0&showTitle=false&size=2252008&status=done&style=none&taskId=u3a38f3c5-bc00-4164-86e4-e2aba42fbe1&title=&width=1500)
## 内存加载ShellCode
通过Jar加载器-内存加载，上传ext目录下的loader.jar
![image.png](https://cdn.nlark.com/yuque/0/2023/png/1599908/1696668416161-4df3612f-2a06-4978-96a6-ed8ac4668247.png#averageHue=%23f7f7f6&clientId=ud0545662-3e42-4&from=paste&height=654&id=ua29c213d&originHeight=817&originWidth=1375&originalType=binary&ratio=2&rotation=0&showTitle=false&size=37802&status=done&style=none&taskId=u90a475c8-88a9-4ee9-8df6-3c6002469a0&title=&width=1100)
可以通过Js引擎执行功能先试一下看类在不在，发现确实可以查找到
![image.png](https://cdn.nlark.com/yuque/0/2023/png/1599908/1696668481406-8ba1cf83-b93e-4233-9e23-c77cbef02367.png#averageHue=%23f7f7f6&clientId=ud0545662-3e42-4&from=paste&height=647&id=uc7a585b1&originHeight=809&originWidth=1373&originalType=binary&ratio=2&rotation=0&showTitle=false&size=37057&status=done&style=none&taskId=uacd8a506-9e65-4e2f-afb2-999a6583281&title=&width=1098.4)
ShellCode加载器模块-加载方式JNA，exploit，弹出计算器，也就实现了内存加载ShellCode的功能
![image.png](https://cdn.nlark.com/yuque/0/2023/png/1599908/1696668561833-0eda2d8f-5319-4b96-9e76-b991071702cf.png#averageHue=%23f5f5f4&clientId=ud0545662-3e42-4&from=paste&height=638&id=ua0c9ac8a&originHeight=797&originWidth=1363&originalType=binary&ratio=2&rotation=0&showTitle=false&size=90448&status=done&style=none&taskId=u962b0acd-af0b-4f28-8bf2-53c1de993eb&title=&width=1090.4)
## SharpLoader
具体实现可以看之前写的文章：https://yzddmr6.com/posts/as-exploits-sharploader/
以Efspotato为例
### 内存加载
选择我们要加载的本地文件即可
![image.png](https://cdn.nlark.com/yuque/0/2022/png/1599908/1646572517831-823a1334-1461-4f3e-996c-cf5e89ee3852.png#averageHue=%23f6f6f6&clientId=u93135a80-6782-4&from=paste&height=664&id=u0d621a84&originHeight=961&originWidth=1054&originalType=binary&ratio=1&rotation=0&showTitle=false&size=85211&status=done&style=none&taskId=u39ff28f1-310c-4a00-bf63-f603395b32b&title=&width=728)
### URL加载
把exp托管到一个web上，然后填写远程URl地址
![image.png](https://cdn.nlark.com/yuque/0/2022/png/1599908/1646572685423-f70e4d6e-6c0c-45ae-94e8-43962610fa0e.png#averageHue=%23f7f7f6&clientId=u93135a80-6782-4&from=paste&height=639&id=u1aca1f5c&originHeight=952&originWidth=1057&originalType=binary&ratio=1&rotation=0&showTitle=false&size=75163&status=done&style=none&taskId=u74375c22-8394-4555-a8a0-0212f31bc84&title=&width=709.5)
需要注意的是，这里有一个坑。
本来想着可以直接去加载github上面各种编译好的payload，但是发现.net 4好像不支持tls1.2
[https://stackoverflow.com/questions/47269609/system-net-securityprotocoltype-tls12-definition-not-found](https://stackoverflow.com/questions/47269609/system-net-securityprotocoltype-tls12-definition-not-found)
![image.png](https://cdn.nlark.com/yuque/0/2022/png/1599908/1641713633036-fec80179-ea9c-4fca-a9db-09cfd878a356.png#averageHue=%23f5f4f4&clientId=u6d502eab-ff80-4&from=paste&height=164&id=wELEX&originHeight=158&originWidth=616&originalType=binary&ratio=1&rotation=0&showTitle=false&size=7773&status=done&style=none&taskId=u02faee3f-87b2-44c0-ba67-0032b58d41f&title=&width=638)
那还是自己搭个http的服务吧
### 通过名称加载
在前面通过内存或者URL加载过的程序集，后续都可以通过项目名来反射加载。
可以先通过 **获取已加载的Assembly** 功能来获取之前所有打进去过的项目名，多个结果以|分割
![image.png](https://cdn.nlark.com/yuque/0/2022/png/1599908/1646573403403-843532f8-63bb-44c1-9b8a-933d525579b0.png#averageHue=%23f6f6f6&clientId=u93135a80-6782-4&from=paste&height=476&id=u9359e3b5&originHeight=686&originWidth=1053&originalType=binary&ratio=1&rotation=0&showTitle=false&size=44549&status=done&style=none&taskId=ubab954dd-283c-4c13-a19b-6aa15932bed&title=&width=730.5)
填入你想要反射的Assembly的名称，加上要执行的参数，exploit！
![image.png](https://cdn.nlark.com/yuque/0/2022/png/1599908/1646573531038-caa8076b-7802-4e55-a2b5-761a6276533d.png#averageHue=%23f6f6f6&clientId=u93135a80-6782-4&from=paste&height=559&id=u5853fd4e&originHeight=796&originWidth=1054&originalType=binary&ratio=1&rotation=0&showTitle=false&size=72498&status=done&style=none&taskId=u3b1eb0ab-574f-45e1-8154-2d01d75711e&title=&width=740)
成功调用
参数内空格分割符：{}
例如需要执行 cmd /c 'net user'
则填写 cmd /c net{}user即可
## 联动JMG实现内存马扩展
As-Exploits设计理念之一就是要提供良好的扩展性，这里以 执行自定义Payload 功能举例。
虽然插件中内置了一些常见的内存马，但是在实际中我们可能想打入一些别的内存马。这里可以借助pen4uin师傅的JMG项目生成一个蚁剑-Listener内存马
打开JMG，选择内存马类型，中间件类型，设置密码，输出格式选择Base64
![image.png](https://cdn.nlark.com/yuque/0/2023/png/1599908/1694511127691-0b1e1848-96b1-493f-ad1c-87d9083d12dc.png#averageHue=%23f5f5f5&clientId=u6448577f-3957-4&from=paste&height=610&id=u42aff9ef&originHeight=1220&originWidth=2096&originalType=binary&ratio=2&rotation=0&showTitle=false&size=1127402&status=done&style=none&taskId=u642767a1-ecff-47cf-8ecf-ccc3c0f1552&title=&width=1048)
 生成之后把Payload贴进去，执行 
![image.png](https://cdn.nlark.com/yuque/0/2023/png/1599908/1694511176482-1b296865-7e46-4b66-8700-d52e367b5745.png#averageHue=%23f0efee&clientId=u6448577f-3957-4&from=paste&height=445&id=u1748ac95&originHeight=890&originWidth=2706&originalType=binary&ratio=2&rotation=0&showTitle=false&size=1239629&status=done&style=none&taskId=u51a9aa00-b0b7-47bf-a1c1-fd7065c1a89&title=&width=1353)
通过内存马管理模块可以看到已经打进去了一个Listener
![image.png](https://cdn.nlark.com/yuque/0/2023/png/1599908/1694511161334-3536b230-d0af-4d26-850a-167f924e973c.png#averageHue=%23edecec&clientId=u6448577f-3957-4&from=paste&height=761&id=u875fbe23&originHeight=1522&originWidth=2968&originalType=binary&ratio=2&rotation=0&showTitle=false&size=1912949&status=done&style=none&taskId=u999023bf-81d1-4573-b330-b2b1c9770fa&title=&width=1484)
配置连接的时候别忘了配置敲门的header参数，成功连接
![image.png](https://cdn.nlark.com/yuque/0/2023/png/1599908/1694511613878-a6f4953e-8ea7-4c6f-9b8c-9d83caf101df.png#averageHue=%23efefef&clientId=u6448577f-3957-4&from=paste&height=440&id=u5993d0c0&originHeight=880&originWidth=1532&originalType=binary&ratio=2&rotation=0&showTitle=false&size=605712&status=done&style=none&taskId=u7cd9e72e-998b-48b3-b7ea-d3e1b33b3d1&title=&width=766)
